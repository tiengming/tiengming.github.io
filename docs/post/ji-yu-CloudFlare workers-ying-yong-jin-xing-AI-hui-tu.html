<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    <style>body[data-ui-pending] #content {opacity:0;transition:opacity 0.3s ease;}</style><script>document.documentElement.setAttribute('data-ui-pending','true');</script><link rel='stylesheet' href='https://code.buxiantang.top/assets/GmeekBaseTheme.css'><script src='https://code.buxiantang.top/assets/GmeekCustomizeCss.js' defer></script><script src='https://blog.meekdai.com/assets/GmeekVercount.js'></script><script type='text/javascript'>(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};t=l.createElement(r);t.async=1;t.src='https://www.clarity.ms/tag/'+i;y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window,document,'clarity','script','na4qnk47pl');</script><script src='https://blog.meekdai.com/assets/GmeekVercount.js'></script>
    <link rel="icon" href="https://code.buxiantang.top/favicon.svg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="## 演示

|   |   |   |
| :---: | :---: | :---: |
|  ![ca6832cf36820f3a0fcfe.png](https://imghosting.buxiantang.top/file/ca6832cf36820f3a0fcfe.png)| ![04beae21d486a3bf87022.png](https://imghosting.buxiantang.top/file/04beae21d486a3bf87022.png) | ![e69b41808e1e6e0ed88ef.png](https://imghosting.buxiantang.top/file/e69b41808e1e6e0ed88ef.png) |
| ![a3f47639e1942ddf9e75b.png](https://imghosting.buxiantang.top/file/a3f47639e1942ddf9e75b.png) |![85651a51a2b7c30fba416.png](https://imghosting.buxiantang.top/file/85651a51a2b7c30fba416.png)  | ![ef1264a0cdd944b15466d.png](https://imghosting.buxiantang.top/file/ef1264a0cdd944b15466d.png) |

## 演示地址：[demo](https://img.buxiantang.top/)

## 部署流程

本项目基于：[cloudflare workers应用系列之6:AI 生成图片 Text to Image App](https://51xmi.com/post0715203336)完成二次开发。">
<meta property="og:title" content="基于CloudFlare workers应用进行AI绘图">
<meta property="og:description" content="## 演示

|   |   |   |
| :---: | :---: | :---: |
|  ![ca6832cf36820f3a0fcfe.png](https://imghosting.buxiantang.top/file/ca6832cf36820f3a0fcfe.png)| ![04beae21d486a3bf87022.png](https://imghosting.buxiantang.top/file/04beae21d486a3bf87022.png) | ![e69b41808e1e6e0ed88ef.png](https://imghosting.buxiantang.top/file/e69b41808e1e6e0ed88ef.png) |
| ![a3f47639e1942ddf9e75b.png](https://imghosting.buxiantang.top/file/a3f47639e1942ddf9e75b.png) |![85651a51a2b7c30fba416.png](https://imghosting.buxiantang.top/file/85651a51a2b7c30fba416.png)  | ![ef1264a0cdd944b15466d.png](https://imghosting.buxiantang.top/file/ef1264a0cdd944b15466d.png) |

## 演示地址：[demo](https://img.buxiantang.top/)

## 部署流程

本项目基于：[cloudflare workers应用系列之6:AI 生成图片 Text to Image App](https://51xmi.com/post0715203336)完成二次开发。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://code.buxiantang.top/post/ji-yu-CloudFlare%20workers-ying-yong-jin-xing-AI-hui-tu.html">
<meta property="og:image" content="https://code.buxiantang.top/favicon.svg">
<title>基于CloudFlare workers应用进行AI绘图</title>



</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">基于CloudFlare workers应用进行AI绘图</h1>
<div class="title-right">
    <a href="https://code.buxiantang.top" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/tiengming/tiengming.github.io/issues/2" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h2>演示</h2>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6d6c1cdb76882ce6dc0e301f93d6465c9c8c9aae4baa14e4f5df1ec4d4ad76d4/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6361363833326366333638323066336130666366652e706e67"><img src="https://camo.githubusercontent.com/6d6c1cdb76882ce6dc0e301f93d6465c9c8c9aae4baa14e4f5df1ec4d4ad76d4/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6361363833326366333638323066336130666366652e706e67" alt="ca6832cf36820f3a0fcfe.png" data-canonical-src="https://imghosting.buxiantang.top/file/ca6832cf36820f3a0fcfe.png" style="max-width: 100%;"></a></td>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e4fe2f39804a76520c5c7bceeb7058f72b7521c298f7381b7d5860cc7389b956/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3034626561653231643438366133626638373032322e706e67"><img src="https://camo.githubusercontent.com/e4fe2f39804a76520c5c7bceeb7058f72b7521c298f7381b7d5860cc7389b956/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3034626561653231643438366133626638373032322e706e67" alt="04beae21d486a3bf87022.png" data-canonical-src="https://imghosting.buxiantang.top/file/04beae21d486a3bf87022.png" style="max-width: 100%;"></a></td>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/5e19a54ded20c96f337c00eb831ecd869507af2a29d6751ad8fcf2211585e4ab/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6536396234313830386531653665306564383865662e706e67"><img src="https://camo.githubusercontent.com/5e19a54ded20c96f337c00eb831ecd869507af2a29d6751ad8fcf2211585e4ab/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6536396234313830386531653665306564383865662e706e67" alt="e69b41808e1e6e0ed88ef.png" data-canonical-src="https://imghosting.buxiantang.top/file/e69b41808e1e6e0ed88ef.png" style="max-width: 100%;"></a></td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/21fdd77d31a33d0f9eab0175fce42be6a5d595068fbd007049ba56a63c8caf7a/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6133663437363339653139343264646639653735622e706e67"><img src="https://camo.githubusercontent.com/21fdd77d31a33d0f9eab0175fce42be6a5d595068fbd007049ba56a63c8caf7a/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6133663437363339653139343264646639653735622e706e67" alt="a3f47639e1942ddf9e75b.png" data-canonical-src="https://imghosting.buxiantang.top/file/a3f47639e1942ddf9e75b.png" style="max-width: 100%;"></a></td>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/d58c8fc00d10941bf9f3cdecfbabf33e873ee978010a4da37676cde81266cd78/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3835363531613531613262376333306662613431362e706e67"><img src="https://camo.githubusercontent.com/d58c8fc00d10941bf9f3cdecfbabf33e873ee978010a4da37676cde81266cd78/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3835363531613531613262376333306662613431362e706e67" alt="85651a51a2b7c30fba416.png" data-canonical-src="https://imghosting.buxiantang.top/file/85651a51a2b7c30fba416.png" style="max-width: 100%;"></a></td>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/3a9ab4fd02af46934ab75baf2c0c198d4eebd0a09b8f3ba86b82435a0c730b3a/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6566313236346130636464393434623135343636642e706e67"><img src="https://camo.githubusercontent.com/3a9ab4fd02af46934ab75baf2c0c198d4eebd0a09b8f3ba86b82435a0c730b3a/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6566313236346130636464393434623135343636642e706e67" alt="ef1264a0cdd944b15466d.png" data-canonical-src="https://imghosting.buxiantang.top/file/ef1264a0cdd944b15466d.png" style="max-width: 100%;"></a></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<h2>演示地址：<a href="https://img.buxiantang.top/" rel="nofollow">demo</a></h2>
<h2>部署流程</h2>
<p>本项目基于：<a href="https://51xmi.com/post0715203336" rel="nofollow">cloudflare workers应用系列之6:AI 生成图片 Text to Image App</a>完成二次开发。</p>
<h3>实现功能：</h3>
<ol>
<li>生成过程中加载动画提示</li>
<li>对原有的中文提示词生成效果不友好进行优化。主要实现过程为：调用大模型和提示词对提示词进行优化，让大模型生成绘图提示词👍👍👍。<em>有一说一，大模型的提示词确实很好😊。</em></li>
</ol>
<h3>部署实现</h3>
<ol>
<li>进入<a href="https://dash.cloudflare.com/" rel="nofollow">cloudflare</a>，并登录；</li>
<li>点击左侧栏<code class="notranslate">workers-and-pages</code></li>
<li>创建workers。</li>
<li>编辑代码，将下方的代码覆盖添加到workers中。</li>
</ol>
<details>
  <summary>点击查看代码</summary>
<pre class="notranslate"><code class="notranslate">```
// worker.ts
const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "POST, OPTIONS",
  "Access-Control-Allow-Headers": "Content-Type",
};

const htmlContent = `
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta property="og:title" content="免费AI文字生成图片" /&gt;
    &lt;meta property="og:image" content="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fa845a04b-d140-4ee9-933e-86358e364583%2F7b32b226-09c3-4f2e-b247-2cfa854149b7%2Flogo.png?id=b3172623-21d8-41c8-9dbc-52425d4ece2b&amp;table=collection&amp;spaceId=a845a04b-d140-4ee9-933e-86358e364583&amp;width=60&amp;userId=a2d6cd07-1a8f-438a-894c-269b862aa1ab&amp;cache=v2" /&gt;
    &lt;link rel="icon" href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fa845a04b-d140-4ee9-933e-86358e364583%2F7b32b226-09c3-4f2e-b247-2cfa854149b7%2Flogo.png?id=b3172623-21d8-41c8-9dbc-52425d4ece2b&amp;table=collection&amp;spaceId=a845a04b-d140-4ee9-933e-86358e364583&amp;width=60&amp;userId=a2d6cd07-1a8f-438a-894c-269b862aa1ab&amp;cache=v2"&gt;
    &lt;link rel="author" href="https://code.buxiantang.top/"&gt;
    &lt;script type="text/javascript"&gt;
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "n8mmwklxas");
    &lt;/script&gt;
    &lt;title&gt;免费AI Image Generator || buxiantang.top &lt;/title&gt;
    &lt;style&gt;
        body {
          font-family: Arial, sans-serif;
          background-color: #f3f4f6;
          color: #333;
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          margin: 0;
        }

        .container {
          max-width: 400px;
          background-color: #fff;
          padding: 40px;
          border-radius: 15px;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
          text-align: center;
        }

        h2 {
          margin-bottom: 20px;
          color: #444;
        }

        .textinput {
          width: calc(100% - 24px);
          height: 40px;
          margin-bottom: 20px;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 5px;
          transition: border-color 0.3s;
        }

        .textinput:focus {
          border-color: #007BFF;
          outline: none;
        }

        .btn-wrapper {
          background-color: #007BFF;
          color: #fff;
          padding: 10px 20px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          transition: background-color 0.3s, box-shadow 0.3s;
        }

        .btn-wrapper:hover {
          background-color: #0056b3;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .aiimage {
          width: 100%;
          max-width: 360px;
          height: auto;
          margin-top: 20px;
          border-radius: 10px;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .aiimage img {
          max-width: 100%;
          border-radius: 10px;
        }
        .links p {
          color: #2b1216;
          text-decoration: none;
          font-size: 12px;
        }
        .inline-links p {
          display: inline;
          margin-right: 10px;
        }
        .links a {
          color: #007BFF;
          text-decoration: none;
          font-size: 12px;
        }

        .links a:hover {
          text-decoration: underline;
        }

        hr {
          border: none;
          border-top: 1px solid #eee;
          margin: 20px 0;
        }

        .loading-spinner {
          border: 8px solid #f3f3f3;
          border-top: 8px solid #007BFF;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          animation: spin 1s linear infinite;
          display: inline-block;
          margin-top: 20px;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .loading-text {
          margin-top: 10px;
          font-size: 14px;
          color: #666;
        }
        .note {
          font-size: 12px;
          color: #666;
          background-color: #f9f9f9;
          border: 1px solid #e1e1e1;
          padding: 8px;
          border-radius: 8px;
          margin-top: 5px;
          text-align: center;
          display: block; 
        }

        /* 将按钮放在一行 */
        .button-group {
          display: flex;
          justify-content: space-between;
          gap: 10px;
        }

        /* 模态窗口样式 */
        .modal {
          display: none; 
          position: fixed; 
          z-index: 1; 
          padding-top: 100px; 
          left: 0;
          top: 0;
          width: 100%; 
          height: 100%; 
          overflow: auto; 
          background-color: rgb(0,0,0); 
          background-color: rgba(0,0,0,0.4); 
        }

        .modal-content {
          background-color: #fefefe;
          margin: auto;
          padding: 20px;
          border: 1px solid #888;
          width: 80%;
          max-width: 400px;
          border-radius: 10px;
          text-align: center;
        }

        .close {
          color: #aaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close:hover,
        .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
        }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class="container"&gt;
      &lt;h2&gt;免费AI Image Generator&lt;/h2&gt;
      &lt;input class="textinput" type="text" id="prompt" value="明月松间照，清泉石上流。" /&gt;
      &lt;p class="note" id="note"&gt;建议使用提示词优化功能，中英文都可！&lt;/p&gt;
      &lt;div class="button-group"&gt;
        &lt;button type="button" id="submit-button" class="btn-wrapper"&gt;🎨 AI生成&lt;/button&gt;
        &lt;button type="button" id="optimize-prompt-button" class="btn-wrapper"&gt;💡 提示词优化&lt;/button&gt;
        &lt;button type="button" id="clear-button" class="btn-wrapper"&gt;✊ 清除&lt;/button&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div class="aiimage" id="image-container"&gt;&lt;/div&gt;
      &lt;div id="loading" style="display: none;"&gt;
        &lt;div class="loading-spinner"&gt;&lt;/div&gt;
        &lt;div class="loading-text"&gt;正在生成，通常需要10s...&lt;/div&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div class="links"&gt;
        &lt;p&gt;develop by &lt;a href="https://51xmi.com/"&gt;51xmi&lt;/a&gt;&lt;/p&gt;
        &lt;div class="inline-links"&gt;
          &lt;p&gt;导航页● &lt;a href="https://nav.buxiantang.top/"&gt;一键网上冲浪&lt;/a&gt;&lt;/p&gt;
          &lt;p&gt;卜仙堂● &lt;a href="https://buxiantang.top/"&gt;佛道仙易修行&lt;/a&gt;&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- 模态窗口 HTML --&gt;
    &lt;div id="myModal" class="modal"&gt;
      &lt;div class="modal-content"&gt;
        &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
        &lt;p id="modal-text"&gt;提示词已优化！&lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
      const promptInput = document.getElementById("prompt");
      const submitButton = document.getElementById("submit-button");
      const imageContainer = document.getElementById("image-container");
      const loading = document.getElementById("loading");
      const note = document.getElementById("note");
      const optimizePromptButton = document.getElementById("optimize-prompt-button");
      const clearButton = document.getElementById("clear-button");

      // 获取模态窗口元素
      const modal = document.getElementById("myModal");
      const closeModal = document.getElementsByClassName("close")[0];

      // 当用户点击 &lt;span&gt; (x), 关闭模态窗口
      closeModal.onclick = function() {
        modal.style.display = "none";
      }

      // 当用户点击窗口外区域时关闭模态窗口
      window.onclick = function(event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      }

      optimizePromptButton.addEventListener("click", async () =&gt; {
        const prompt = promptInput.value;
        if (!prompt.trim()) {
          alert("请输入提示词");
          return;
        }
        loading.style.display = 'block';
        const optimizedPrompt = await optimizePromptAI(prompt);
        showOptimizationResult(optimizedPrompt);
        loading.style.display = 'none';
      });

      submitButton.addEventListener("click", async () =&gt; {
        const prompt = promptInput.value;
        if (!prompt.trim()) {
          alert("请输入提示词");
          return;
        }
        note.style.display = 'block';
        const requestBody = { content: prompt };

        imageContainer.innerHTML = '';
        loading.style.display = 'block';

        try {
          const response = await fetchWithTimeout("/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestBody),
          });

          if (response.ok) {
            const imageBlob = await response.blob();
            const imageUrl = URL.createObjectURL(imageBlob);

            const image = document.createElement("img");
            image.src = imageUrl;
            image.onload = () =&gt; { note.style.display = 'none'; };
            imageContainer.appendChild(image);
          } else {
            throw new Error("Error generating image");
          }
        } catch (error) {
          alert(error.message);
        } finally {
          loading.style.display = 'none';
        }
      });

      clearButton.addEventListener("click", () =&gt; {
        promptInput.value = "";
        imageContainer.innerHTML = "";
        note.style.display = 'block';
      });

      async function optimizePromptAI(content) {
        const promptTemplate = "您是一位专业的提示词工程师,负责优化用户输入的绘画提示词。您的任务是根据输入的绘画提示词创建一个详细的Stable Diffusion绘图提示词,包括具体的绘画风格、主题、色彩要求、画质、其他细节,并按照以下格式的英文语言输出:Prompt: [风格][主题][色彩][其他细节]...。Negative Prompt: [残缺的][畸形的]...举个例子：我输入的绘画提示词为：“一个长发蓝色眼睛的女孩”，你创建的Stable Diffusion绘图提示词为：“Prompt: Long-haired girl with blue eyes, beautiful detailed eyes and lips, flowing blonde hair, serene expression, standing in a field of wildflowers. (best quality,4k,8k,highres,masterpiece:1.2), ultra-detailed, (realistic,photorealistic,photo-realistic:1.37), HDR, UHD, studio lighting, physically-based rendering, extreme detail description, professional, vivid colors, bokeh, portraits, impressionist painting style, warm color temperature, soft natural light.Negative Prompt: nsfw, (low quality,normal quality,worst quality,jpeg artifacts), cropped, monochrome, lowres, low saturation, watermark, white letters, skin spots, acnes, skin blemishes, age spot, mutated hands, mutated fingers, deformed, bad anatomy, disfigured, poorly drawn face, extra limb, ugly, poorly drawn hands, missing limb, floating limbs, disconnected limbs, out of focus, long neck, long body, extra fingers, fewer fingers, multi nipples, bad hands, signature, username, bad feet, blurry, bad body.”请你直接输出创建的Stable Diffusion绘图提示词，不要包含其他内容。我的绘画提示词为：";
        const prompt = \`\${promptTemplate}"\${content}"\`;

        try {
          const response = await fetchWithTimeout("/optimize-prompt", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ content: prompt }),
          });

          if (response.ok) {
            const result = await response.json();
            return result.optimizedPrompt;
          } else {
            throw new Error("Error optimizing prompt");
          }
        } catch (error) {
          console.error("Optimization error:", error);
          alert("提示词优化失败: " + error.message);
          return null;
        }
      }

      function showOptimizationResult(optimizedPrompt) {
        if (optimizedPrompt) {
          // 提取response字段
          const response = JSON.parse(optimizedPrompt).response;
          // 在输入框中显示response字段的内容
          promptInput.value = response;
          // 显示自定义模态窗口
          document.getElementById("modal-text").innerText = "提示词已优化！";
          modal.style.display = "block";
        } else {
          // 无法优化提示词，弹窗提示
          document.getElementById("modal-text").innerText = "无法优化提示词，请重试。";
          modal.style.display = "block";
        }
      }
      
      function fetchWithTimeout(url, options, timeout = 30000) {
        return Promise.race([
          fetch(url, options),
          new Promise((_, reject) =&gt; 
            setTimeout(() =&gt; reject(new Error('请求超时')), timeout)
          )
        ]);
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
`;

export default {
  async fetch(request, env) {
    if (request.method === "OPTIONS") {
      return new Response(null, { headers: corsHeaders });
    }

    if (request.method === "POST") {
      try {
        const { content } = await request.json();
        if (!content || typeof content !== 'string') {
          throw new Error("Invalid input");
        }

        if (new URL(request.url).pathname === "/optimize-prompt") {
          const response = await env.AI.run(
            "@hf/meta-llama/meta-llama-3-8b-instruct",
            { prompt: content }
          );
          const optimizedPrompt = typeof response === 'string' ? response : JSON.stringify(response);
          return new Response(JSON.stringify({ optimizedPrompt }), {
            headers: {
              "Content-Type": "application/json",
              ...corsHeaders,
            },
          });
        } else {
          const response = await env.AI.run(
            "@cf/bytedance/stable-diffusion-xl-lightning",
            { prompt: content }
          );
          return new Response(response, {
            headers: {
              "content-type": "image/png",
              ...corsHeaders,
            },
          });
        }
      } catch (error) {
        console.error("Error in fetch function:", error);
        return new Response(JSON.stringify({ error: error.message }), {
          status: 500,
          headers: {
            "Content-Type": "application/json",
            ...corsHeaders,
          },
        });
      }
    }

    return new Response(htmlContent, {
      headers: { "Content-Type": "text/html" },
    });
  },
};
```
</code></pre>
</details>
<ol start="5">
<li>添加自定义域，你的自定义域就是访问地址</li>
</ol>
<h3>后续功能</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" id="" disabled="" class="task-list-item-checkbox" aria-label="Incomplete task"> 已生成图片展示</li>
<li class="task-list-item"><input type="checkbox" id="" disabled="" class="task-list-item-checkbox" aria-label="Incomplete task"> 可选上传图床，分享图片</li>
<li class="task-list-item"><input type="checkbox" id="" disabled="" class="task-list-item-checkbox" aria-label="Incomplete task"> ...</li>
</ul>
<p>另外，我也提供AI绘图服务。详见咸鱼店铺：<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/661a765976ebbf11bb04880b703b7b04dea0259fe4bf3ec87bb26c68c127fe8b/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3865666639643366633533386264316463386530312e6a7067"><img src="https://camo.githubusercontent.com/661a765976ebbf11bb04880b703b7b04dea0259fe4bf3ec87bb26c68c127fe8b/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3865666639643366633533386264316463386530312e6a7067" alt="8eff9d3fc538bd1dc8e01.jpg" data-canonical-src="https://imghosting.buxiantang.top/file/8eff9d3fc538bd1dc8e01.jpg" style="max-width: 100%;"></a></p>
<h3>许可证</h3>
<p>本项目遵循<a href="https://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">Apache-2.0</a></p></div>
<div style="font-size:small;margin-top:8px;float:right;">🤞转载请注明出处🤞</div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://code.buxiantang.top">Tiengming</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","tiengming/tiengming.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>
<script src='https://code.buxiantang.top/assets/backtop.js'></script><script src='https://code.buxiantang.top/assets/articletoc.js'></script><script src='https://code.buxiantang.top/assets/pagination.js'></script><script src='https://code.buxiantang.top/assets/lightbox.js'></script><script>document.querySelectorAll('a').forEach(anchor => {const img = anchor.querySelector('img');if (img && img.hasAttribute('data-canonical-src')) {const canonicalSrc = img.getAttribute('data-canonical-src');anchor.setAttribute('href', canonicalSrc);img.setAttribute('src', canonicalSrc);img.removeAttribute('data-canonical-src');}});</script>

</html>

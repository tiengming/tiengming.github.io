<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    <script src='https://blog.meekdai.com/assets/GmeekVercount.js'></script>
    <link rel="icon" href="https://code.buxiantang.top/favicon.svg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="## æ¼”ç¤º

|   |   |   |
| :---: | :---: | :---: |
|  ![ca6832cf36820f3a0fcfe.png](https://imghosting.buxiantang.top/file/ca6832cf36820f3a0fcfe.png)| ![04beae21d486a3bf87022.png](https://imghosting.buxiantang.top/file/04beae21d486a3bf87022.png) | ![e69b41808e1e6e0ed88ef.png](https://imghosting.buxiantang.top/file/e69b41808e1e6e0ed88ef.png) |
| ![a3f47639e1942ddf9e75b.png](https://imghosting.buxiantang.top/file/a3f47639e1942ddf9e75b.png) |![85651a51a2b7c30fba416.png](https://imghosting.buxiantang.top/file/85651a51a2b7c30fba416.png)  | ![ef1264a0cdd944b15466d.png](https://imghosting.buxiantang.top/file/ef1264a0cdd944b15466d.png) |

## æ¼”ç¤ºåœ°å€ï¼š[demo](https://img.buxiantang.top/)

## éƒ¨ç½²æµç¨‹

æœ¬é¡¹ç›®åŸºäºï¼š[cloudflare workersåº”ç”¨ç³»åˆ—ä¹‹6:AI ç”Ÿæˆå›¾ç‰‡ Text to Image App](https://51xmi.com/post0715203336)å®ŒæˆäºŒæ¬¡å¼€å‘ã€‚">
<meta property="og:title" content="åŸºäºCloudFlare workersåº”ç”¨è¿›è¡ŒAIç»˜å›¾">
<meta property="og:description" content="## æ¼”ç¤º

|   |   |   |
| :---: | :---: | :---: |
|  ![ca6832cf36820f3a0fcfe.png](https://imghosting.buxiantang.top/file/ca6832cf36820f3a0fcfe.png)| ![04beae21d486a3bf87022.png](https://imghosting.buxiantang.top/file/04beae21d486a3bf87022.png) | ![e69b41808e1e6e0ed88ef.png](https://imghosting.buxiantang.top/file/e69b41808e1e6e0ed88ef.png) |
| ![a3f47639e1942ddf9e75b.png](https://imghosting.buxiantang.top/file/a3f47639e1942ddf9e75b.png) |![85651a51a2b7c30fba416.png](https://imghosting.buxiantang.top/file/85651a51a2b7c30fba416.png)  | ![ef1264a0cdd944b15466d.png](https://imghosting.buxiantang.top/file/ef1264a0cdd944b15466d.png) |

## æ¼”ç¤ºåœ°å€ï¼š[demo](https://img.buxiantang.top/)

## éƒ¨ç½²æµç¨‹

æœ¬é¡¹ç›®åŸºäºï¼š[cloudflare workersåº”ç”¨ç³»åˆ—ä¹‹6:AI ç”Ÿæˆå›¾ç‰‡ Text to Image App](https://51xmi.com/post0715203336)å®ŒæˆäºŒæ¬¡å¼€å‘ã€‚">
<meta property="og:type" content="article">
<meta property="og:url" content="https://code.buxiantang.top/post/ji-yu-CloudFlare%20workers-ying-yong-jin-xing-AI-hui-tu.html">
<meta property="og:image" content="https://code.buxiantang.top/favicon.svg">
<title>åŸºäºCloudFlare workersåº”ç”¨è¿›è¡ŒAIç»˜å›¾</title>



</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">åŸºäºCloudFlare workersåº”ç”¨è¿›è¡ŒAIç»˜å›¾</h1>
<div class="title-right">
    <a href="https://code.buxiantang.top" id="buttonHome" class="btn btn-invisible circle" title="é¦–é¡µ">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/tiengming/tiengming.github.io/issues/2" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="åˆ‡æ¢ä¸»é¢˜">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h2>æ¼”ç¤º</h2>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/77e86be854730d3d65613d52a34500d91340059738872bad72ae1b422995aa9c/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6361363833326366333638323066336130666366652e706e67"><img src="https://camo.githubusercontent.com/77e86be854730d3d65613d52a34500d91340059738872bad72ae1b422995aa9c/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6361363833326366333638323066336130666366652e706e67" alt="ca6832cf36820f3a0fcfe.png" data-canonical-src="https://imghosting.buxiantang.top/file/ca6832cf36820f3a0fcfe.png" style="max-width: 100%;"></a></td>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/1707930e05c8cd0afcec87fe03ba73d4205591bb145ac30d599219810888ac9f/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3034626561653231643438366133626638373032322e706e67"><img src="https://camo.githubusercontent.com/1707930e05c8cd0afcec87fe03ba73d4205591bb145ac30d599219810888ac9f/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3034626561653231643438366133626638373032322e706e67" alt="04beae21d486a3bf87022.png" data-canonical-src="https://imghosting.buxiantang.top/file/04beae21d486a3bf87022.png" style="max-width: 100%;"></a></td>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/492c00c111149c115cffe0460036aa466f47bf61752838bccf113eb13d4f0649/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6536396234313830386531653665306564383865662e706e67"><img src="https://camo.githubusercontent.com/492c00c111149c115cffe0460036aa466f47bf61752838bccf113eb13d4f0649/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6536396234313830386531653665306564383865662e706e67" alt="e69b41808e1e6e0ed88ef.png" data-canonical-src="https://imghosting.buxiantang.top/file/e69b41808e1e6e0ed88ef.png" style="max-width: 100%;"></a></td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/b79c825965f82b185d8fc3de599e57c5d7fba1885cac17fa4c7061ef1d0a2eaf/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6133663437363339653139343264646639653735622e706e67"><img src="https://camo.githubusercontent.com/b79c825965f82b185d8fc3de599e57c5d7fba1885cac17fa4c7061ef1d0a2eaf/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6133663437363339653139343264646639653735622e706e67" alt="a3f47639e1942ddf9e75b.png" data-canonical-src="https://imghosting.buxiantang.top/file/a3f47639e1942ddf9e75b.png" style="max-width: 100%;"></a></td>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/acde6b72bb33a94fd9a13a920582ef340d9ccfaa12d16d3849681f9f3e9a6a29/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3835363531613531613262376333306662613431362e706e67"><img src="https://camo.githubusercontent.com/acde6b72bb33a94fd9a13a920582ef340d9ccfaa12d16d3849681f9f3e9a6a29/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3835363531613531613262376333306662613431362e706e67" alt="85651a51a2b7c30fba416.png" data-canonical-src="https://imghosting.buxiantang.top/file/85651a51a2b7c30fba416.png" style="max-width: 100%;"></a></td>
<td align="center"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/887ec755bfaed5d6519a39d2a4be8f186a527420e00c4d2b94362148c374b079/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6566313236346130636464393434623135343636642e706e67"><img src="https://camo.githubusercontent.com/887ec755bfaed5d6519a39d2a4be8f186a527420e00c4d2b94362148c374b079/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f6566313236346130636464393434623135343636642e706e67" alt="ef1264a0cdd944b15466d.png" data-canonical-src="https://imghosting.buxiantang.top/file/ef1264a0cdd944b15466d.png" style="max-width: 100%;"></a></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<h2>æ¼”ç¤ºåœ°å€ï¼š<a href="https://img.buxiantang.top/" rel="nofollow">demo</a></h2>
<h2>éƒ¨ç½²æµç¨‹</h2>
<p>æœ¬é¡¹ç›®åŸºäºï¼š<a href="https://51xmi.com/post0715203336" rel="nofollow">cloudflare workersåº”ç”¨ç³»åˆ—ä¹‹6:AI ç”Ÿæˆå›¾ç‰‡ Text to Image App</a>å®ŒæˆäºŒæ¬¡å¼€å‘ã€‚</p>
<h3>å®ç°åŠŸèƒ½ï¼š</h3>
<ol>
<li>ç”Ÿæˆè¿‡ç¨‹ä¸­åŠ è½½åŠ¨ç”»æç¤º</li>
<li>å¯¹åŸæœ‰çš„ä¸­æ–‡æç¤ºè¯ç”Ÿæˆæ•ˆæœä¸å‹å¥½è¿›è¡Œä¼˜åŒ–ã€‚ä¸»è¦å®ç°è¿‡ç¨‹ä¸ºï¼šè°ƒç”¨å¤§æ¨¡å‹å’Œæç¤ºè¯å¯¹æç¤ºè¯è¿›è¡Œä¼˜åŒ–ï¼Œè®©å¤§æ¨¡å‹ç”Ÿæˆç»˜å›¾æç¤ºè¯ğŸ‘ğŸ‘ğŸ‘ã€‚<em>æœ‰ä¸€è¯´ä¸€ï¼Œå¤§æ¨¡å‹çš„æç¤ºè¯ç¡®å®å¾ˆå¥½ğŸ˜Šã€‚</em></li>
</ol>
<h3>éƒ¨ç½²å®ç°</h3>
<ol>
<li>è¿›å…¥<a href="https://dash.cloudflare.com/" rel="nofollow">cloudflare</a>ï¼Œå¹¶ç™»å½•ï¼›</li>
<li>ç‚¹å‡»å·¦ä¾§æ <code class="notranslate">workers-and-pages</code></li>
<li>åˆ›å»ºworkersã€‚</li>
<li>ç¼–è¾‘ä»£ç ï¼Œå°†ä¸‹æ–¹çš„ä»£ç è¦†ç›–æ·»åŠ åˆ°workersä¸­ã€‚</li>
</ol>
<details>
  <summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary>
<pre class="notranslate"><code class="notranslate">```
// worker.ts
const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "POST, OPTIONS",
  "Access-Control-Allow-Headers": "Content-Type",
};

const htmlContent = `
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta property="og:title" content="å…è´¹AIæ–‡å­—ç”Ÿæˆå›¾ç‰‡" /&gt;
    &lt;meta property="og:image" content="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fa845a04b-d140-4ee9-933e-86358e364583%2F7b32b226-09c3-4f2e-b247-2cfa854149b7%2Flogo.png?id=b3172623-21d8-41c8-9dbc-52425d4ece2b&amp;table=collection&amp;spaceId=a845a04b-d140-4ee9-933e-86358e364583&amp;width=60&amp;userId=a2d6cd07-1a8f-438a-894c-269b862aa1ab&amp;cache=v2" /&gt;
    &lt;link rel="icon" href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fa845a04b-d140-4ee9-933e-86358e364583%2F7b32b226-09c3-4f2e-b247-2cfa854149b7%2Flogo.png?id=b3172623-21d8-41c8-9dbc-52425d4ece2b&amp;table=collection&amp;spaceId=a845a04b-d140-4ee9-933e-86358e364583&amp;width=60&amp;userId=a2d6cd07-1a8f-438a-894c-269b862aa1ab&amp;cache=v2"&gt;
    &lt;link rel="author" href="https://code.buxiantang.top/"&gt;
    &lt;script type="text/javascript"&gt;
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "n8mmwklxas");
    &lt;/script&gt;
    &lt;title&gt;å…è´¹AI Image Generator || buxiantang.top &lt;/title&gt;
    &lt;style&gt;
        body {
          font-family: Arial, sans-serif;
          background-color: #f3f4f6;
          color: #333;
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          margin: 0;
        }

        .container {
          max-width: 400px;
          background-color: #fff;
          padding: 40px;
          border-radius: 15px;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
          text-align: center;
        }

        h2 {
          margin-bottom: 20px;
          color: #444;
        }

        .textinput {
          width: calc(100% - 24px);
          height: 40px;
          margin-bottom: 20px;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 5px;
          transition: border-color 0.3s;
        }

        .textinput:focus {
          border-color: #007BFF;
          outline: none;
        }

        .btn-wrapper {
          background-color: #007BFF;
          color: #fff;
          padding: 10px 20px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          transition: background-color 0.3s, box-shadow 0.3s;
        }

        .btn-wrapper:hover {
          background-color: #0056b3;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .aiimage {
          width: 100%;
          max-width: 360px;
          height: auto;
          margin-top: 20px;
          border-radius: 10px;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .aiimage img {
          max-width: 100%;
          border-radius: 10px;
        }
        .links p {
          color: #2b1216;
          text-decoration: none;
          font-size: 12px;
        }
        .inline-links p {
          display: inline;
          margin-right: 10px;
        }
        .links a {
          color: #007BFF;
          text-decoration: none;
          font-size: 12px;
        }

        .links a:hover {
          text-decoration: underline;
        }

        hr {
          border: none;
          border-top: 1px solid #eee;
          margin: 20px 0;
        }

        .loading-spinner {
          border: 8px solid #f3f3f3;
          border-top: 8px solid #007BFF;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          animation: spin 1s linear infinite;
          display: inline-block;
          margin-top: 20px;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .loading-text {
          margin-top: 10px;
          font-size: 14px;
          color: #666;
        }
        .note {
          font-size: 12px;
          color: #666;
          background-color: #f9f9f9;
          border: 1px solid #e1e1e1;
          padding: 8px;
          border-radius: 8px;
          margin-top: 5px;
          text-align: center;
          display: block; 
        }

        /* å°†æŒ‰é’®æ”¾åœ¨ä¸€è¡Œ */
        .button-group {
          display: flex;
          justify-content: space-between;
          gap: 10px;
        }

        /* æ¨¡æ€çª—å£æ ·å¼ */
        .modal {
          display: none; 
          position: fixed; 
          z-index: 1; 
          padding-top: 100px; 
          left: 0;
          top: 0;
          width: 100%; 
          height: 100%; 
          overflow: auto; 
          background-color: rgb(0,0,0); 
          background-color: rgba(0,0,0,0.4); 
        }

        .modal-content {
          background-color: #fefefe;
          margin: auto;
          padding: 20px;
          border: 1px solid #888;
          width: 80%;
          max-width: 400px;
          border-radius: 10px;
          text-align: center;
        }

        .close {
          color: #aaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close:hover,
        .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
        }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class="container"&gt;
      &lt;h2&gt;å…è´¹AI Image Generator&lt;/h2&gt;
      &lt;input class="textinput" type="text" id="prompt" value="æ˜æœˆæ¾é—´ç…§ï¼Œæ¸…æ³‰çŸ³ä¸Šæµã€‚" /&gt;
      &lt;p class="note" id="note"&gt;å»ºè®®ä½¿ç”¨æç¤ºè¯ä¼˜åŒ–åŠŸèƒ½ï¼Œä¸­è‹±æ–‡éƒ½å¯ï¼&lt;/p&gt;
      &lt;div class="button-group"&gt;
        &lt;button type="button" id="submit-button" class="btn-wrapper"&gt;ğŸ¨ AIç”Ÿæˆ&lt;/button&gt;
        &lt;button type="button" id="optimize-prompt-button" class="btn-wrapper"&gt;ğŸ’¡ æç¤ºè¯ä¼˜åŒ–&lt;/button&gt;
        &lt;button type="button" id="clear-button" class="btn-wrapper"&gt;âœŠ æ¸…é™¤&lt;/button&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div class="aiimage" id="image-container"&gt;&lt;/div&gt;
      &lt;div id="loading" style="display: none;"&gt;
        &lt;div class="loading-spinner"&gt;&lt;/div&gt;
        &lt;div class="loading-text"&gt;æ­£åœ¨ç”Ÿæˆï¼Œé€šå¸¸éœ€è¦10s...&lt;/div&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div class="links"&gt;
        &lt;p&gt;develop by &lt;a href="https://51xmi.com/"&gt;51xmi&lt;/a&gt;&lt;/p&gt;
        &lt;div class="inline-links"&gt;
          &lt;p&gt;å¯¼èˆªé¡µâ— &lt;a href="https://nav.buxiantang.top/"&gt;ä¸€é”®ç½‘ä¸Šå†²æµª&lt;/a&gt;&lt;/p&gt;
          &lt;p&gt;åœä»™å ‚â— &lt;a href="https://buxiantang.top/"&gt;ä½›é“ä»™æ˜“ä¿®è¡Œ&lt;/a&gt;&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- æ¨¡æ€çª—å£ HTML --&gt;
    &lt;div id="myModal" class="modal"&gt;
      &lt;div class="modal-content"&gt;
        &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
        &lt;p id="modal-text"&gt;æç¤ºè¯å·²ä¼˜åŒ–ï¼&lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
      const promptInput = document.getElementById("prompt");
      const submitButton = document.getElementById("submit-button");
      const imageContainer = document.getElementById("image-container");
      const loading = document.getElementById("loading");
      const note = document.getElementById("note");
      const optimizePromptButton = document.getElementById("optimize-prompt-button");
      const clearButton = document.getElementById("clear-button");

      // è·å–æ¨¡æ€çª—å£å…ƒç´ 
      const modal = document.getElementById("myModal");
      const closeModal = document.getElementsByClassName("close")[0];

      // å½“ç”¨æˆ·ç‚¹å‡» &lt;span&gt; (x), å…³é—­æ¨¡æ€çª—å£
      closeModal.onclick = function() {
        modal.style.display = "none";
      }

      // å½“ç”¨æˆ·ç‚¹å‡»çª—å£å¤–åŒºåŸŸæ—¶å…³é—­æ¨¡æ€çª—å£
      window.onclick = function(event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      }

      optimizePromptButton.addEventListener("click", async () =&gt; {
        const prompt = promptInput.value;
        if (!prompt.trim()) {
          alert("è¯·è¾“å…¥æç¤ºè¯");
          return;
        }
        loading.style.display = 'block';
        const optimizedPrompt = await optimizePromptAI(prompt);
        showOptimizationResult(optimizedPrompt);
        loading.style.display = 'none';
      });

      submitButton.addEventListener("click", async () =&gt; {
        const prompt = promptInput.value;
        if (!prompt.trim()) {
          alert("è¯·è¾“å…¥æç¤ºè¯");
          return;
        }
        note.style.display = 'block';
        const requestBody = { content: prompt };

        imageContainer.innerHTML = '';
        loading.style.display = 'block';

        try {
          const response = await fetchWithTimeout("/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestBody),
          });

          if (response.ok) {
            const imageBlob = await response.blob();
            const imageUrl = URL.createObjectURL(imageBlob);

            const image = document.createElement("img");
            image.src = imageUrl;
            image.onload = () =&gt; { note.style.display = 'none'; };
            imageContainer.appendChild(image);
          } else {
            throw new Error("Error generating image");
          }
        } catch (error) {
          alert(error.message);
        } finally {
          loading.style.display = 'none';
        }
      });

      clearButton.addEventListener("click", () =&gt; {
        promptInput.value = "";
        imageContainer.innerHTML = "";
        note.style.display = 'block';
      });

      async function optimizePromptAI(content) {
        const promptTemplate = "æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„æç¤ºè¯å·¥ç¨‹å¸ˆ,è´Ÿè´£ä¼˜åŒ–ç”¨æˆ·è¾“å…¥çš„ç»˜ç”»æç¤ºè¯ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯æ ¹æ®è¾“å…¥çš„ç»˜ç”»æç¤ºè¯åˆ›å»ºä¸€ä¸ªè¯¦ç»†çš„Stable Diffusionç»˜å›¾æç¤ºè¯,åŒ…æ‹¬å…·ä½“çš„ç»˜ç”»é£æ ¼ã€ä¸»é¢˜ã€è‰²å½©è¦æ±‚ã€ç”»è´¨ã€å…¶ä»–ç»†èŠ‚,å¹¶æŒ‰ç…§ä»¥ä¸‹æ ¼å¼çš„è‹±æ–‡è¯­è¨€è¾“å‡º:Prompt: [é£æ ¼][ä¸»é¢˜][è‰²å½©][å…¶ä»–ç»†èŠ‚]...ã€‚Negative Prompt: [æ®‹ç¼ºçš„][ç•¸å½¢çš„]...ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘è¾“å…¥çš„ç»˜ç”»æç¤ºè¯ä¸ºï¼šâ€œä¸€ä¸ªé•¿å‘è“è‰²çœ¼ç›çš„å¥³å­©â€ï¼Œä½ åˆ›å»ºçš„Stable Diffusionç»˜å›¾æç¤ºè¯ä¸ºï¼šâ€œPrompt: Long-haired girl with blue eyes, beautiful detailed eyes and lips, flowing blonde hair, serene expression, standing in a field of wildflowers. (best quality,4k,8k,highres,masterpiece:1.2), ultra-detailed, (realistic,photorealistic,photo-realistic:1.37), HDR, UHD, studio lighting, physically-based rendering, extreme detail description, professional, vivid colors, bokeh, portraits, impressionist painting style, warm color temperature, soft natural light.Negative Prompt: nsfw, (low quality,normal quality,worst quality,jpeg artifacts), cropped, monochrome, lowres, low saturation, watermark, white letters, skin spots, acnes, skin blemishes, age spot, mutated hands, mutated fingers, deformed, bad anatomy, disfigured, poorly drawn face, extra limb, ugly, poorly drawn hands, missing limb, floating limbs, disconnected limbs, out of focus, long neck, long body, extra fingers, fewer fingers, multi nipples, bad hands, signature, username, bad feet, blurry, bad body.â€è¯·ä½ ç›´æ¥è¾“å‡ºåˆ›å»ºçš„Stable Diffusionç»˜å›¾æç¤ºè¯ï¼Œä¸è¦åŒ…å«å…¶ä»–å†…å®¹ã€‚æˆ‘çš„ç»˜ç”»æç¤ºè¯ä¸ºï¼š";
        const prompt = \`\${promptTemplate}"\${content}"\`;

        try {
          const response = await fetchWithTimeout("/optimize-prompt", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ content: prompt }),
          });

          if (response.ok) {
            const result = await response.json();
            return result.optimizedPrompt;
          } else {
            throw new Error("Error optimizing prompt");
          }
        } catch (error) {
          console.error("Optimization error:", error);
          alert("æç¤ºè¯ä¼˜åŒ–å¤±è´¥: " + error.message);
          return null;
        }
      }

      function showOptimizationResult(optimizedPrompt) {
        if (optimizedPrompt) {
          // æå–responseå­—æ®µ
          const response = JSON.parse(optimizedPrompt).response;
          // åœ¨è¾“å…¥æ¡†ä¸­æ˜¾ç¤ºresponseå­—æ®µçš„å†…å®¹
          promptInput.value = response;
          // æ˜¾ç¤ºè‡ªå®šä¹‰æ¨¡æ€çª—å£
          document.getElementById("modal-text").innerText = "æç¤ºè¯å·²ä¼˜åŒ–ï¼";
          modal.style.display = "block";
        } else {
          // æ— æ³•ä¼˜åŒ–æç¤ºè¯ï¼Œå¼¹çª—æç¤º
          document.getElementById("modal-text").innerText = "æ— æ³•ä¼˜åŒ–æç¤ºè¯ï¼Œè¯·é‡è¯•ã€‚";
          modal.style.display = "block";
        }
      }
      
      function fetchWithTimeout(url, options, timeout = 30000) {
        return Promise.race([
          fetch(url, options),
          new Promise((_, reject) =&gt; 
            setTimeout(() =&gt; reject(new Error('è¯·æ±‚è¶…æ—¶')), timeout)
          )
        ]);
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
`;

export default {
  async fetch(request, env) {
    if (request.method === "OPTIONS") {
      return new Response(null, { headers: corsHeaders });
    }

    if (request.method === "POST") {
      try {
        const { content } = await request.json();
        if (!content || typeof content !== 'string') {
          throw new Error("Invalid input");
        }

        if (new URL(request.url).pathname === "/optimize-prompt") {
          const response = await env.AI.run(
            "@hf/meta-llama/meta-llama-3-8b-instruct",
            { prompt: content }
          );
          const optimizedPrompt = typeof response === 'string' ? response : JSON.stringify(response);
          return new Response(JSON.stringify({ optimizedPrompt }), {
            headers: {
              "Content-Type": "application/json",
              ...corsHeaders,
            },
          });
        } else {
          const response = await env.AI.run(
            "@cf/bytedance/stable-diffusion-xl-lightning",
            { prompt: content }
          );
          return new Response(response, {
            headers: {
              "content-type": "image/png",
              ...corsHeaders,
            },
          });
        }
      } catch (error) {
        console.error("Error in fetch function:", error);
        return new Response(JSON.stringify({ error: error.message }), {
          status: 500,
          headers: {
            "Content-Type": "application/json",
            ...corsHeaders,
          },
        });
      }
    }

    return new Response(htmlContent, {
      headers: { "Content-Type": "text/html" },
    });
  },
};
```
</code></pre>
</details>
<ol start="5">
<li>æ·»åŠ è‡ªå®šä¹‰åŸŸï¼Œä½ çš„è‡ªå®šä¹‰åŸŸå°±æ˜¯è®¿é—®åœ°å€</li>
</ol>
<h3>åç»­åŠŸèƒ½</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" id="" disabled="" class="task-list-item-checkbox"> å·²ç”Ÿæˆå›¾ç‰‡å±•ç¤º</li>
<li class="task-list-item"><input type="checkbox" id="" disabled="" class="task-list-item-checkbox"> å¯é€‰ä¸Šä¼ å›¾åºŠï¼Œåˆ†äº«å›¾ç‰‡</li>
<li class="task-list-item"><input type="checkbox" id="" disabled="" class="task-list-item-checkbox"> ...</li>
</ul>
<p>å¦å¤–ï¼Œæˆ‘ä¹Ÿæä¾›AIç»˜å›¾æœåŠ¡ã€‚è¯¦è§å’¸é±¼åº—é“ºï¼š<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/a5558484db6f38ad2bb470e42eb8398dc9c4367921e02b93c43a6d0cb39cc06b/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3865666639643366633533386264316463386530312e6a7067"><img src="https://camo.githubusercontent.com/a5558484db6f38ad2bb470e42eb8398dc9c4367921e02b93c43a6d0cb39cc06b/68747470733a2f2f696d67686f7374696e672e62757869616e74616e672e746f702f66696c652f3865666639643366633533386264316463386530312e6a7067" alt="8eff9d3fc538bd1dc8e01.jpg" data-canonical-src="https://imghosting.buxiantang.top/file/8eff9d3fc538bd1dc8e01.jpg" style="max-width: 100%;"></a></p>
<h3>è®¸å¯è¯</h3>
<p>æœ¬é¡¹ç›®éµå¾ª<a href="https://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">Apache-2.0</a></p></div>
<div style="font-size:small;margin-top:8px;float:right;">ğŸ¤è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ğŸ¤</div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">è¯„è®º</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright Â© <span id="copyrightYear"></span> <a href="https://code.buxiantang.top">Tiengming</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="ç½‘ç«™è¿è¡Œ"+diffDay+"å¤©"+" â€¢ ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","tiengming/tiengming.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}
</script>
<script src='https://code.buxiantang.top/assets/backtop.js'></script><script src='https://code.buxiantang.top/assets/articletoc.js'></script><script src='https://code.buxiantang.top/assets/pagination.js'></script><script src='https://code.buxiantang.top/assets/lightbox.js'></script><script src='https://code.buxiantang.top/assets/codecopy.js'></script>

</html>
